<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jcep.admin.dao.BusinessMapper">
<!-- 사업관리 > 사업운영 실적관리 > 기업지원  -->
	<select id="selectBenefitEnterpriseIdx" parameterType="jcep.admin.model.BusinessVO" resultType="java.lang.String">
		SELECT concat('B',IFNULL(LPAD(MAX(SUBSTRING(enterprise_idx,2,LENGTH(enterprise_idx))) + 1,9,'0'),'000000000')) AS enterpriseIdx 
		  FROM tb_jcep_benefit_perform
	</select>


<!-- 지원사업수혜실적 -->
	<select id="selectBusinessSupportBenefitList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT 
					a.enterprise_idx           AS enterpriseIdx,
					a.buss_anncemnt_no 	AS bussAnncemntNo,
					a.perform_nm 				AS benefitPerformNm,
				    b.buss_fr_dt 				AS bussFrDt,
				    b.buss_to_dt 				AS bussToDt,
				    b.buss_dept_cd 			AS bussDeptCd,
				    b.buss_dept_nm 			AS bussDeptNm,
				    a.reg_dt 					AS regDt
			    
			  FROM (
						SELECT enterprise_idx,
						    		buss_anncemnt_no , 
						    		member_id , 
						    		perform_nm,
						    		MIN(date_format(reg_dt,'%Y-%m-%d')) as reg_dt 
						   FROM  tb_jcep_benefit_perform
						GROUP BY enterprise_idx
			) a INNER JOIN  (SELECT 
				 								buss_anncemnt_no,
											    date_format(buss_fr_dt,'%Y-%m-%d') AS buss_fr_dt,
											    date_format(buss_to_dt,'%Y-%m-%d') AS buss_to_dt,
											    buss_dept_cd,		
											    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND t.common_cd = t1.buss_dept_cd) AS buss_dept_nm	 								
			 						 FROM	 tb_business_announcement t1		
			) b
			ON a.buss_anncemnt_no = b.buss_anncemnt_no
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(a.perform_nm LIKE CONCAT('%',#{searchText},'%') OR b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%') )
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
				</choose>
			</if> 
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           AND ((b.buss_to_dt >= #{searchFromDate} AND b.buss_to_dt <= #{searchToDate})
						    OR (b.buss_fr_dt >= #{searchFromDate} AND b.buss_fr_dt <= #{searchToDate})
						    OR (b.buss_fr_dt <= #{searchFromDate} AND b.buss_to_dt >= #{searchToDate}))
					]]>	     
			</if> 					
			ORDER BY a.enterprise_idx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBusinessSupportBenefitListTotCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT 
					count(*) AS totCnt
			    
			  FROM (
						SELECT  enterprise_idx,
						    		buss_anncemnt_no , 
						    		member_id , 
						    		perform_nm,
						    		MIN(date_format(reg_dt,'%Y-%m-%d')) as reg_dt 
						   FROM  tb_jcep_benefit_perform
						GROUP BY enterprise_idx
			) a INNER JOIN  (SELECT 
				 								buss_anncemnt_no,
											    date_format(buss_fr_dt,'%Y-%m-%d') AS buss_fr_dt,
											    date_format(buss_to_dt,'%Y-%m-%d') AS buss_to_dt,
											    buss_dept_cd,		
											    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND t.common_cd = t1.buss_dept_cd) AS buss_dept_nm	 								
			 						 FROM	 tb_business_announcement t1		
			) b
			ON a.buss_anncemnt_no = b.buss_anncemnt_no
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(a.perform_nm LIKE CONCAT('%',#{searchText},'%') OR b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%') )
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
				</choose>
			</if>
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           AND ((b.buss_to_dt >= #{searchFromDate} AND b.buss_to_dt <= #{searchToDate})
						    OR (b.buss_fr_dt >= #{searchFromDate} AND b.buss_fr_dt <= #{searchToDate})
						    OR (b.buss_fr_dt <= #{searchFromDate} AND b.buss_to_dt >= #{searchToDate}))
					]]>	     
			</if> 				 
	</select>
	
<!-- 사업관리 > 사업운영 실적관리 > 기업지원 > 지원사업수혜실적 상세 -->
	<select id="selectBusinessSupportBenefitDetailList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT 
			    		a.enterprise_idx           AS enterpriseIdx,
			    		a.buss_anncemnt_no 	AS bussAnncemntNo , 
			    		a.member_id 				AS memberId, 
			    		a.perform_nm			 	AS benefitPerformNm,
			    		a.buss_cont 				AS bussCont,
			    		a.entpr_nm 				AS entprNm,
			    		a.emp_create_staff 		AS empCreateStaff,
			    		a.remark 					AS remark,
			    		b.buss_anncemnt_nm 	AS bussAnncemntNm
			   FROM tb_jcep_benefit_perform a 
			   INNER JOIN tb_business_announcement b
			      ON a.buss_anncemnt_no =  b.buss_anncemnt_no
  			 WHERE a.enterprise_idx = #{enterpriseIdx}
			
	</select>	

<!-- 기업찾기-지원사업수혜실적  -->		
	<select id="selectBenefitPerformEntprSearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT * 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
		            C.entpr_creat_job_cnt AS entprCreatJobCnt
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
			INNER JOIN tb_enterprise_jcep_buss C
			    ON B.buss_anncemnt_no = C.buss_anncemnt_no
               AND B.member_id           = C.member_id
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
                AND C.entpr_buss_yn = 'Y'
			) T
			 WHERE 1=1
			<if test="searchText1 != null and searchText1 != ''">
		        AND T.entprNm LIKE CONCAT('%',#{searchText1},'%')
			</if> 		
			<if test="bussAnncemntNo != null and bussAnncemntNo != ''">
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			</if> 	
			ORDER BY 	T.bussAnncemntNo	,T.memberId DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
				
	</select>	
	
<!-- 기업찾기-지원사업수혜실적  -->		
	<select id="selectBenefitPerformEntprSearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
	SELECT count(*) as totcnt 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
		            C.entpr_creat_job_cnt AS entprCreatJobCnt
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
			INNER JOIN tb_enterprise_jcep_buss C
			    ON B.buss_anncemnt_no = C.buss_anncemnt_no
               AND B.member_id           = C.member_id
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
                AND C.entpr_buss_yn = 'Y'
			) T
			 WHERE 1=1
			<if test="searchText1 != null and searchText1 != ''">
		        AND T.entprNm LIKE CONCAT('%',#{searchText1},'%')
			</if> 		
			<if test="bussAnncemntNo != null and bussAnncemntNo != ''">
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			</if> 	
					
	</select>		
	
<!-- 기업찾기-지원사업수혜실적  -->		
	<select id="selectBenefitPerformEntprSelectList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT * 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
		            C.entpr_creat_job_cnt AS entprCreatJobCnt
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
			INNER JOIN tb_enterprise_jcep_buss C
			    ON B.buss_anncemnt_no = C.buss_anncemnt_no
               AND B.member_id           = C.member_id
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
                AND C.entpr_buss_yn = 'Y'
			) T
			 WHERE 1=1
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			<if test="membersId != null">
			    AND T.memberId in 
				<foreach collection="membersId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
	</select>		
		
	
<!-- 지원사업수혜실적정보 존재여부 조회 -->	
	<select id="selectJcepBenefitPerformCnt" parameterType="java.util.Map" resultType="int">
		SELECT count(*) cnt
		  FROM tb_jcep_benefit_perform 
		WHERE 1=1
			AND enterprise_idx        = #{enterpriseIdx}
		    AND buss_anncemnt_no = #{bussAnncemntNo}
		    AND member_id            = #{memberId}
	</select>		
	
	
<!-- 지원사업수혜실적정보 등록 -->	
	<insert id="insertJcepBenefitPerform" parameterType="java.util.Map">
		INSERT INTO  tb_jcep_benefit_perform(
			enterprise_idx,
			buss_anncemnt_no,
			member_id,
			perform_nm,
			buss_cont,
			entpr_nm,
			emp_create_staff,
			remark,
			reg_dt,
			reg_id
		)VALUES(
			#{enterpriseIdx},
			#{bussAnncemntNo},
			#{memberId},
			#{benefitPerformNm},
			#{bussCont},
			#{entprNm},
			#{empCreateStaff},
			#{remark},
            date_format(CURRENT_TIMESTAMP,'%Y%m%d'),
			'admin'
		)

	</insert>	
	
<!-- 지원사업수혜실적정보 수정 -->	
	<select id="updateJcepBenefitPerform" parameterType="java.util.Map" resultType="int">
		UPDATE tb_jcep_benefit_perform
		     SET perform_nm 				= #{benefitPerformNm},
		           buss_cont              	= #{bussCont},
		           entpr_nm					= #{entprNm},
		           emp_create_staff		= #{empCreateStaff},
		           remark						= #{remark}
		 WHERE enterprise_idx 		= #{enterpriseIdx}
		     AND buss_anncemnt_no = #{bussAnncemntNo}
		     AND member_id           = #{memberId}    
	</select>	
	
<!-- 지원사업수혜실적정보 삭제 -->	
	<select id="deleteJcepBenefitPerform" parameterType="java.util.Map" resultType="int">
		DELETE FROM tb_jcep_benefit_perform 
		WHERE enterprise_idx = #{enterpriseIdx}
		  AND concat(buss_anncemnt_no,member_id) not in 
				<foreach collection="memberId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>		
	</select>			
	

<!-- 콘텐츠개발 및 제작지원실적 -->
	<select id="selectBusinessContentPerformList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT 
					a.enterprise_idx           AS enterpriseIdx,
					a.buss_anncemnt_no 	AS bussAnncemntNo,
					a.perform_nm 				AS contentPerformNm,
				    b.buss_fr_dt 				AS bussFrDt,
				    b.buss_to_dt 				AS bussToDt,
				    b.buss_dept_cd 			AS bussDeptCd,
				    b.buss_dept_nm 			AS bussDeptNm,
				    a.reg_dt 					AS regDt
			    
			  FROM (
						SELECT 
						    		enterprise_idx,
						    		buss_anncemnt_no , 
						    		member_id , 
						    		perform_nm,
						    		MIN(date_format(reg_dt,'%Y-%m-%d')) as reg_dt 
						   FROM  tb_jcep_content_perform
						GROUP BY enterprise_idx
			) a INNER JOIN  (SELECT 
				 								buss_anncemnt_no,
											    date_format(buss_fr_dt,'%Y-%m-%d') AS buss_fr_dt,
											    date_format(buss_to_dt,'%Y-%m-%d') AS buss_to_dt,
											    buss_dept_cd,		
											    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND t.common_cd = t1.buss_dept_cd) AS buss_dept_nm	 								
			 						 FROM	 tb_business_announcement t1		
			) b
			ON a.buss_anncemnt_no = b.buss_anncemnt_no
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(a.perform_nm LIKE CONCAT('%',#{searchText},'%') OR b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%') )
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
				</choose>
			</if> 
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           AND ((b.buss_to_dt >= #{searchFromDate} AND b.buss_to_dt <= #{searchToDate})
						    OR (b.buss_fr_dt >= #{searchFromDate} AND b.buss_fr_dt <= #{searchToDate})
						    OR (b.buss_fr_dt <= #{searchFromDate} AND b.buss_to_dt >= #{searchToDate}))
					]]>	     
			</if> 			
			ORDER BY a.enterprise_idx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBusinessContentPerformListTotCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT 
					count(*) AS totCnt
			    
			  FROM (
						SELECT enterprise_idx,
						    		buss_anncemnt_no , 
						    		member_id , 
						    		perform_nm,
						    		MIN(date_format(reg_dt,'%Y-%m-%d')) as reg_dt 
						   FROM  tb_jcep_content_perform
						GROUP BY enterprise_idx
			) a INNER JOIN  (SELECT 
				 								buss_anncemnt_no,
											    date_format(buss_fr_dt,'%Y-%m-%d') AS buss_fr_dt,
											    date_format(buss_to_dt,'%Y-%m-%d') AS buss_to_dt,
											    buss_dept_cd,		
											    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND t.common_cd = t1.buss_dept_cd) AS buss_dept_nm	 								
			 						 FROM	 tb_business_announcement t1		
			) b
			ON a.buss_anncemnt_no = b.buss_anncemnt_no
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(a.perform_nm LIKE CONCAT('%',#{searchText},'%') OR b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%') )
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.buss_dept_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
				</choose>
			</if>
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           AND ((b.buss_to_dt >= #{searchFromDate} AND b.buss_to_dt <= #{searchToDate})
						    OR (b.buss_fr_dt >= #{searchFromDate} AND b.buss_fr_dt <= #{searchToDate})
						    OR (b.buss_fr_dt <= #{searchFromDate} AND b.buss_to_dt >= #{searchToDate}))
					]]>	     
			</if> 	
	</select>
	
	<select id="selectBusinessContentPerformDetailList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT 
			    		a.enterprise_idx			AS enterpriseIdx,
			    		a.buss_anncemnt_no 	AS bussAnncemntNo , 
			    		a.member_id 				AS memberId, 
			    		a.perform_nm			 	AS contentPerformNm,
			    		a.buss_cont 				AS bussCont,
			    		a.entpr_nm 				AS entprNm,
			    		a.content_divi_cd 		AS contentDiviCd,
			    		a.content_nm		 		AS contentNm,
			    		a.remark 					AS remark,
			    		b.buss_anncemnt_nm 	AS bussAnncemntNm
			   FROM tb_jcep_content_perform a 
			   INNER JOIN tb_business_announcement b
			      ON a.buss_anncemnt_no =  b.buss_anncemnt_no
  			 WHERE a.enterprise_idx = #{enterpriseIdx}
			
	</select>		

<!-- 기업찾기-콘텐츠  -->		
	<select id="selectContentPerformEntprSearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT * 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
			) T
			 WHERE 1=1
			<if test="searchText1 != null and searchText1 != ''">
		        AND T.entprNm LIKE CONCAT('%',#{searchText1},'%')
			</if> 		
			<if test="bussAnncemntNo != null and bussAnncemntNo != ''">
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			</if> 	
			ORDER BY 	T.bussAnncemntNo	,T.memberId DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}						
	</select>			
	
	<select id="selectContentPerformEntprSearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
	SELECT count(*) totcnt 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
			) T
			 WHERE 1=1
			<if test="searchText1 != null and searchText1 != ''">
		        AND T.entprNm LIKE CONCAT('%',#{searchText1},'%')
			</if> 		
			<if test="bussAnncemntNo != null and bussAnncemntNo != ''">
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			</if> 				
	</select>	
	
<!-- 기업찾기-콘텐츠  -->		
	<select id="selectContentPerformEntprSelectList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT * 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
			) T
			 WHERE 1=1
			 AND T.bussAnncemntNo = #{bussAnncemntNo}
			<if test="membersId != null">
			    AND T.memberId in 
				<foreach collection="membersId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
	</select>	
	
<!-- 콘텐츠개발 및 제작지원실적 존재여부 조회 -->	
	<select id="selectJcepContentPerformCnt" parameterType="java.util.Map" resultType="int">
		SELECT count(*) cnt
		  FROM tb_jcep_content_perform 
		WHERE 1=1
		    AND enterprise_idx        = #{enterpriseIdx}
		    AND buss_anncemnt_no = #{bussAnncemntNo}
		    AND member_id            = #{memberId}
	</select>		
	
	<select id="selectContentEnterpriseIdx" parameterType="jcep.admin.model.BusinessVO" resultType="java.lang.String">
		SELECT concat('C',IFNULL(LPAD(MAX(SUBSTRING(enterprise_idx,2,LENGTH(enterprise_idx))) + 1,9,'0'),'000000000')) AS enterpriseIdx 
		  FROM tb_jcep_content_perform
	</select>	
	
<!-- 콘텐츠개발 및 제작지원실적 등록 -->	
	<insert id="insertJcepContentPerform" parameterType="java.util.Map">
		INSERT INTO  tb_jcep_content_perform(
			enterprise_idx,
			buss_anncemnt_no,
			member_id,
			perform_nm,
			buss_cont,
			entpr_nm,
			content_divi_cd,
			content_nm,
			remark,
			reg_dt,
			reg_id
		)VALUES(
			#{enterpriseIdx},
			#{bussAnncemntNo},
			#{memberId},
			#{contentPerformNm},
			#{bussCont},
			#{entprNm},
			#{contentDiviCd},
			#{contentNm},
			#{remark},
            date_format(CURRENT_TIMESTAMP,'%Y%m%d'),
			'admin'
		)

	</insert>	
	
<!-- 콘텐츠개발 및 제작지원실적 수정 -->	
	<select id="updateJcepContentPerform" parameterType="java.util.Map" resultType="int">
		UPDATE tb_jcep_content_perform
		     SET perform_nm 				= #{contentPerformNm},
		           buss_cont              	= #{bussCont},
		           entpr_nm					= #{entprNm},
		           content_divi_cd		= #{contentDiviCd},
		           content_nm				= #{contentNm},
		           remark						= #{remark}
		 WHERE enterprise_idx        = #{enterpriseIdx} 
		     AND buss_anncemnt_no = #{bussAnncemntNo}
		     AND member_id            = #{memberId}    
	</select>	
	
<!-- 콘텐츠개발 및 제작지원실적 삭제 -->	
	<select id="deleteJcepContentPerform" parameterType="java.util.Map" resultType="int">
		DELETE FROM tb_jcep_content_perform 
		WHERE enterprise_idx = #{enterpriseIdx} 
		   AND concat(buss_anncemnt_no,member_id) not in 
				 <foreach collection="memberId" item="item" index="index" separator="," open="(" close=")">
			 		#{item}
				 </foreach>		
	</select>			
	
	
<!-- 지적재산권현황 -->	
	<select id="selectBusinessIntltProptyList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT 
					a.enterprise_idx			AS enterpriseIdx,
					a.intlt_idx					AS intltIdx,
					a.buss_anncemnt_no 	AS bussAnncemntNo,
					a.perform_nm		 		AS intltPerformNm,
					a.intlt_propt_cd 			AS intltProptyCd,
					a.intlt_propt_cd_nm 		AS intltProptyCdNm,
					b.buss_anncemnt_nm 	AS bussAnncemntNm,
				    b.buss_fr_dt 				AS bussFrDt,
				    b.buss_to_dt 				AS bussToDt,
				    b.buss_dept_cd 			AS bussDeptCd,
				    b.buss_dept_nm 			AS bussDeptNm,
				    a.reg_dt 					AS regDt
			    
			  FROM (
						SELECT 
									T1.enterprise_idx,
						    		T1.buss_anncemnt_no , 
						    		T1.member_id , 
						    		T1.perform_nm,
						    		T2.intlt_propt_cd,
						    		T1.intlt_idx,
						    		(SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00019' AND common_cd = T2.intlt_propt_cd) AS intlt_propt_cd_nm,
						    		MIN(date_format(T1.reg_dt,'%Y-%m-%d')) as reg_dt 
						   FROM  tb_jcep_intlt_propty T1
						   INNER JOIN tb_enterprise_intlt_propty T2
						      ON  T1.intlt_idx					= T2.enterprise_idx
						      AND T1.member_id				= T2.member_id          
						GROUP BY T1.enterprise_idx
			) a INNER JOIN  (SELECT 
				 								buss_anncemnt_no,
				 								buss_anncemnt_nm,
											    date_format(buss_fr_dt,'%Y-%m-%d') AS buss_fr_dt,
											    date_format(buss_to_dt,'%Y-%m-%d') AS buss_to_dt,
											    buss_dept_cd,		
											    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND t.common_cd = t1.buss_dept_cd) AS buss_dept_nm	 								
			 						 FROM	 tb_business_announcement t1		
			) b
			ON a.buss_anncemnt_no = b.buss_anncemnt_no
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(a.intlt_propt_cd_nm LIKE CONCAT('%',#{searchText},'%') OR a.perform_nm LIKE CONCAT('%',#{searchText},'%') OR b.buss_anncemnt_nm LIKE CONCAT('%',#{searchText},'%') )
					</when>
		            <when test='searchType eq 1'>
						AND	a.intlt_propt_cd_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 3'>
						AND	b.buss_anncemnt_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
				</choose>
			</if>
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           AND ((b.buss_to_dt >= #{searchFromDate} AND b.buss_to_dt <= #{searchToDate})
						    OR (b.buss_fr_dt >= #{searchFromDate} AND b.buss_fr_dt <= #{searchToDate})
						    OR (b.buss_fr_dt <= #{searchFromDate} AND b.buss_to_dt >= #{searchToDate}))
					]]>	     
			</if> 	
			ORDER BY a.enterprise_idx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBusinessIntltProptyListTotCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT 
					count(*) AS totcnt
			    
			  FROM (
						SELECT 
						  			T1.enterprise_idx,
						    		T1.buss_anncemnt_no , 
						    		T1.member_id , 
						    		T1.perform_nm,
						    		T2.intlt_propt_cd,
						    		(SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00019' AND common_cd = T2.intlt_propt_cd) AS intlt_propt_cd_nm,
						    		MIN(date_format(T1.reg_dt,'%Y-%m-%d')) as reg_dt 
						   FROM  tb_jcep_intlt_propty T1
						   INNER JOIN tb_enterprise_intlt_propty T2
						      ON  T1.intlt_idx					= T2.enterprise_idx
						      AND T1.member_id				= T2.member_id          
						GROUP BY T1.enterprise_idx
			) a INNER JOIN  (SELECT 
				 								buss_anncemnt_no,
				 								buss_anncemnt_nm,
											    date_format(buss_fr_dt,'%Y-%m-%d') AS buss_fr_dt,
											    date_format(buss_to_dt,'%Y-%m-%d') AS buss_to_dt,
											    buss_dept_cd,		
											    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND t.common_cd = t1.buss_dept_cd) AS buss_dept_nm	 								
			 						 FROM	 tb_business_announcement t1		
			) b
			ON a.buss_anncemnt_no = b.buss_anncemnt_no
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(a.intlt_propt_cd_nm LIKE CONCAT('%',#{searchText},'%') OR a.perform_nm LIKE CONCAT('%',#{searchText},'%') OR b.buss_anncemnt_nm LIKE CONCAT('%',#{searchText},'%') )
					</when>
		            <when test='searchType eq 1'>
						AND	a.intlt_propt_cd_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 3'>
						AND	b.buss_anncemnt_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
				</choose>
			</if>
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           AND ((b.buss_to_dt >= #{searchFromDate} AND b.buss_to_dt <= #{searchToDate})
						    OR (b.buss_fr_dt >= #{searchFromDate} AND b.buss_fr_dt <= #{searchToDate})
						    OR (b.buss_fr_dt <= #{searchFromDate} AND b.buss_to_dt >= #{searchToDate}))
					]]>	     
			</if> 	
	</select>
	
	<select id="selectBusinessIntltProptyDetailList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT 
			    		a.enterprise_idx 			AS enterpriseIdx , 
			    		a.buss_anncemnt_no 	AS bussAnncemntNo , 
			    		a.member_id 				AS memberId, 
			    		a.intlt_idx					AS intltIdx, 
			    		a.perform_nm 				AS intltPerformNm,
			    		a.entpr_nm 				AS entprNm,
			    		a.reg_nation_cd 			AS regNationCd,
			    		a.intlt_propt_reg_no		AS intltProptRegNo,
			    		a.remark 					AS remark,
			    		b.buss_anncemnt_nm 	AS bussAnncemntNm,
			    		c.intlt_propt_perf_nm   AS intltProptPerfNm
			   FROM tb_jcep_intlt_propty a 
			   INNER JOIN tb_business_announcement b
			      ON a.buss_anncemnt_no =  b.buss_anncemnt_no
			   INNER JOIN  tb_enterprise_intlt_propty c
			      ON a.intlt_idx  = c.enterprise_idx
			     AND a.member_id      = c.member_id  
  			 WHERE a.enterprise_idx = #{enterpriseIdx}
	</select>		
	
<!-- 실적찾기-지적재산권현황  -->		
	<select id="selectIntltProptySearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT * 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
		            C.enterprise_idx AS intltIdx,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
                    C.intlt_propt_perf_nm AS intltProptPerfNm,
                    C.intlt_propt_cd AS intltProptCd,
                    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00019' AND common_cd = C.intlt_propt_cd) AS intltProptCdNm,
                    date_format(C.reg_dt,'%Y-%m-%d')  AS regDt
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
            INNER JOIN tb_enterprise_intlt_propty C  
				ON B.member_id = C.member_id
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
			) T
			 WHERE 1=1
			<if test="searchText1 != null and searchText1 != ''">
		        AND T.intltProptPerfNm LIKE CONCAT('%',#{searchText1},'%')
			</if> 		
			<if test="searchType1 != null and searchType1 != ''">
		        AND T.intltProptCd = #{searchType1}
			</if> 					
			<if test="bussAnncemntNo != null and bussAnncemntNo != ''">
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			</if> 	
			ORDER BY 	T.bussAnncemntNo	,T.intltIdx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}						
	</select>			
	
	<select id="selectIntltProptySearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
	SELECT count(*) totcnt 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
		            C.enterprise_idx AS enterpriseIdx,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
                    C.intlt_propt_perf_nm AS intltProptPerfNm,
                    C.intlt_propt_cd AS intltProptCd,
                    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00019' AND common_cd = C.intlt_propt_cd) AS intltProptCdNm,
                    date_format(C.reg_dt,'%Y-%m-%d')  AS regDt
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
            INNER JOIN tb_enterprise_intlt_propty C  
				ON B.member_id = C.member_id
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
			) T
			 WHERE 1=1
			<if test="searchText1 != null and searchText1 != ''">
		        AND T.intltProptPerfNm LIKE CONCAT('%',#{searchText1},'%')
			</if> 		
			<if test="searchType1 != null and searchType1 != ''">
		        AND T.intltProptCd = #{searchType1}
			</if> 					
			<if test="bussAnncemntNo != null and bussAnncemntNo != ''">
		        AND T.bussAnncemntNo = #{bussAnncemntNo}
			</if> 			
	</select>	
	
<!-- 실적선택-지적재산권현황  -->		
	<select id="selectIntltProptySelectList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT * 
	   FROM (
			SELECT
					A.buss_anncemnt_no AS bussAnncemntNo,
					A.buss_anncemnt_nm AS bussAnncemntNm,
		            B.member_id AS memberId,
		            C.enterprise_idx AS intltIdx,
					(SELECT entpr_nm FROM tb_enterprise WHERE member_id = B.member_id) AS  entprNm,
		            A.buss_dept_cd AS bussDeptCd,
		            (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
                    C.intlt_propt_perf_nm AS intltProptPerfNm,
                    C.intlt_propt_cd AS intltProptCd,
                    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00019' AND common_cd = C.intlt_propt_cd) AS intltProptCdNm,
                    C.reg_nation_cd AS regNationCd,
                    (SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00021' AND common_cd = C.reg_nation_cd) AS regNationCdNm,
                    C.intlt_propt_reg_no AS intltProptRegNo,
                    date_format(C.reg_dt,'%Y-%m-%d')  AS regDt
			 FROM tb_business_announcement A
            INNER JOIN tb_buss_anncemnt_appl B
			    ON A.buss_anncemnt_no =  B.buss_anncemnt_no
            INNER JOIN tb_enterprise_intlt_propty C  
				ON B.member_id = C.member_id
			WHERE 1=1
			    AND A.buss_divi_cd = 'Y'
                AND B.applic_st_cd = '000004'
			) T
			 WHERE 1=1
			 AND T.bussAnncemntNo = #{bussAnncemntNo}
			<if test="membersId != null">
			    AND T.intltIdx in 
				<foreach collection="membersId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
	</select>	
	
<!-- 지적재산권현황 존재여부 조회 -->	
	<select id="selectJcepIntltProptyCnt" parameterType="java.util.Map" resultType="int">
		SELECT count(*) cnt
		  FROM tb_jcep_intlt_propty 
		WHERE 1=1
		    AND enterprise_idx 		= #{enterpriseIdx}
		    AND intlt_idx				= #{intltIdx}
		    AND buss_anncemnt_no = #{bussAnncemntNo}
		    AND member_id            = #{memberId}
	</select>		
	
	<select id="selectIntltEnterpriseIdx" parameterType="jcep.admin.model.BusinessVO" resultType="java.lang.String">
		SELECT concat('I',IFNULL(LPAD(MAX(SUBSTRING(enterprise_idx,2,LENGTH(enterprise_idx))) + 1,9,'0'),'000000000')) AS enterpriseIdx 
		  FROM tb_jcep_intlt_propty
	</select>	
	
<!-- 지적재산권현황 등록 -->	
	<insert id="insertJcepIntltPropty" parameterType="java.util.Map">
		INSERT INTO  tb_jcep_intlt_propty(
			enterprise_idx,
			buss_anncemnt_no,
			member_id,
			intlt_idx,
			perform_nm,
			entpr_nm,
			intlt_propt_perf_nm,
			reg_nation_cd,
			intlt_propt_reg_no,
			remark,
			reg_dt,
			reg_id
		)VALUES(
			#{enterpriseIdx},
			#{bussAnncemntNo},
			#{memberId},
			#{intltIdx},
			#{intltPerformNm},
			#{entprNm},
			#{intltProptPerfNm},
			#{regNationCd},
			#{intltProptRegNo},
			#{remark},
            date_format(CURRENT_TIMESTAMP,'%Y%m%d'),			'admin'
		)

	</insert>	
	
<!-- 지적재산권현황 수정 -->	
	<select id="updateJcepIntltPropty" parameterType="java.util.Map" resultType="int">
		UPDATE tb_jcep_intlt_propty
		     SET perform_nm 				= #{intltPerformNm},
		           entpr_nm              	= #{entprNm},
		           intlt_propt_perf_nm	= #{intltProptPerfNm},
		           reg_nation_cd			= #{regNationCd},
		           intlt_propt_reg_no		= #{intltProptRegNo},
		           remark						= #{remark}
		 WHERE enterprise_idx          = #{enterpriseIdx}
		 	 AND intlt_idx					= #{intltIdx}
		     AND buss_anncemnt_no   = #{bussAnncemntNo}
		     AND member_id              = #{memberId}
	</select>	
	
<!-- 지적재산권현황 삭제 -->	
	<select id="deleteJcepIntltPropty" parameterType="java.util.Map" resultType="int">
		DELETE FROM tb_jcep_intlt_propty 
		WHERE enterprise_idx          = #{enterpriseIdx}
			AND concat(intlt_idx,member_id,buss_anncemnt_no) not in 
				<foreach collection="memberId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>		
	</select>		
		
	
<!-- 기업유치,창업현황 -->		
	<select id="selectBusinessAttractList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
	SELECT
	     * 
	   FROM (
			SELECT
				enterprise_idx AS enterpriseIdx,
                member_id AS memberId,
                perform_nm AS attractPerformNm,
                date_format(reg_dt,'%Y-%m-%d') as regDt
			FROM tb_jcep_buss_attract a
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
				AND	perform_nm LIKE CONCAT('%',#{searchText},'%')
			</if> 
			<if test="searchFromDate != null and searchFromDate != ''">
                AND reg_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
                AND reg_dt <![CDATA[<= ]]> replace(#{searchToDate},'-','')
			</if> 				
			GROUP BY enterprise_idx
			) T
			ORDER BY T.enterpriseIdx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBusinessAttractListTotCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
		SELECT 
		   count(enterprise_idx) totcnt
		FROM (SELECT
				enterprise_idx
			FROM tb_jcep_buss_attract a
			WHERE 1=1
			<if test="searchText != null and searchText != ''">
				AND	perform_nm LIKE CONCAT('%',#{searchText},'%')
			</if> 
			<if test="searchFromDate != null and searchFromDate != ''">
                AND reg_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
                AND reg_dt <![CDATA[<= ]]> replace(#{searchToDate},'-','')
			</if> 
		) T		
	</select>
	
	<select id="selectBusinessAttractDetailList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT 
			    		a.enterprise_idx 										AS enterpriseIdx, 
			    		a.member_id 											AS memberId, 
			    		a.entpr_nm												AS entprNm, 
			    		a.perform_nm		 									AS attractPerformNm,
			    		date_format(a.entpr_est_dt,'%Y-%m-%d')	AS entprEstDt,
			    		a.entpr_capital_amt									AS entprCapitalAmt,
			    		a.remark 												AS remark
			   FROM tb_jcep_buss_attract a 
  			 WHERE a.enterprise_idx = #{enterpriseIdx}
	</select>			


	
<!-- 기업찾기-기업유치,창업  -->		
	<select id="selectBussAttractEntprSearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT 
			    a.member_id AS memberId,
			    a.entpr_nm  AS entprNm,
			    a.large_buss_area_cd AS largeBussAreaCd,
			    (SELECT common_nm FROM ta_common c WHERE group_cd = 'G00002' AND c.common_cd = a.large_buss_area_cd)  AS entprType,
			    a.entpr_capital_amt AS entprCapitalAmt,
			    a.entpr_est_dt AS entprEstDt,
				( SELECT entpr_result_emp_cnt
			        FROM  tb_enterprise_result t 
			       WHERE  t.member_id = a.member_id
			      ORDER BY  t.entpr_result_year_cd DESC
			               ,t.entpr_result_qta_cd  DESC
			      LIMIT 1
			    )           as entprResultEmpCnt
			FROM tb_enterprise a    
			WHERE 1=1
			<if test="searchFromDate != null and searchFromDate != ''">
		        AND a.entpr_est_dt >= #{searchFromDate}
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
		        AND a.entpr_est_dt <![CDATA[<= ]]>#{searchToDate}
			</if> 		
			<if test="searchType1 != null and searchType1 != ''">
		        AND a.large_buss_area_cd = #{searchType1}
			</if> 					
			ORDER BY a.member_id DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}						
	</select>			
	
	<select id="selectBussAttractEntprSearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT 
			    count(*) totcnt
			FROM tb_enterprise a    
			WHERE 1=1
			AND NOT EXISTS (SELECT 'N' FROM tb_jcep_buss_attract b where b.member_id = a.member_id)
			<if test="searchFromDate != null and searchFromDate != ''">
		        AND a.entpr_est_dt >= #{searchFromDate}
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
		        AND a.entpr_est_dt <![CDATA[<= ]]>#{searchToDate}
			</if> 		
			<if test="searchType != null and searchType != ''">
		        AND T.large_buss_area_cd = #{searchType}
			</if> 		
	</select>	
	
<!-- 실적선택-지적재산권현황  -->		
	<select id="selectBussAttractEntprSelectList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT 
			    a.member_id AS memberId,
			    a.entpr_nm  AS entprNm,
			    a.large_buss_area_cd AS largeBussAreaCd,
			    (SELECT common_nm FROM ta_common c WHERE group_cd = 'G00002' AND c.common_cd = a.large_buss_area_cd)  AS entprType,
			    a.entpr_capital_amt AS entprCapitalAmt,
			    a.entpr_est_dt AS entprEstDt,
				( SELECT entpr_result_emp_cnt
			        FROM  tb_enterprise_result t 
			       WHERE  t.member_id = a.member_id
			      ORDER BY  t.entpr_result_year_cd DESC
			               ,t.entpr_result_qta_cd  DESC
			      LIMIT 1
			    )           as entprResultEmpCnt
			FROM tb_enterprise a    
			WHERE 1=1
			<if test="membersId != null">
			    AND a.member_id in 
				<foreach collection="membersId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
	</select>			
	
<!-- 기업유치,창업 존재여부 조회 -->	
	<select id="selectJcepBussAttractCnt" parameterType="java.util.Map" resultType="int">
		SELECT count(*) cnt
		  FROM tb_jcep_buss_attract 
		WHERE 1=1
		    AND enterprise_idx 		= #{enterpriseIdx}
		    AND member_id            = #{memberId}
	</select>		
	
 <!-- idx 채번 -->	
	<select id="selectAttractEnterpriseIdx" parameterType="jcep.admin.model.BusinessVO" resultType="java.lang.String">
		SELECT concat('A',IFNULL(LPAD(MAX(SUBSTRING(enterprise_idx,2,LENGTH(enterprise_idx))) + 1,9,'0'),'000000000')) AS enterpriseIdx 
		  FROM tb_jcep_buss_attract
	</select>		
	
<!-- 지적재산권현황 등록 -->	
	<insert id="insertJcepBussAttract" parameterType="java.util.Map">
		INSERT INTO  tb_jcep_buss_attract(
			enterprise_idx,
			member_id,
			perform_nm,
			entpr_nm,
			entpr_est_dt,
			entpr_type,
			entpr_capital_amt,
			remark,
			reg_dt,
			reg_id
		)VALUES(
	        #{enterpriseIdx},
			#{memberId},
			#{attractPerformNm},
			#{entprNm},
			replace(#{entprEstDt},'-',''),
			#{entprType},
			#{entprCapitalAmt},
			#{remark},
            date_format(CURRENT_TIMESTAMP,'%Y%m%d'),
			'admin'
		)

	</insert>	
	
<!-- 지적재산권현황 수정 -->	
	<select id="updateJcepBussAttract" parameterType="java.util.Map" resultType="int">
		UPDATE tb_jcep_buss_attract
		     SET perform_nm 				= #{attractPerformNm},
		           entpr_nm              	= #{entprNm},
		           entpr_est_dt			= replace(#{entprEstDt},'-',''),
		           entpr_type				= #{entprType},
		           entpr_capital_amt		= #{entprCapitalAmt},
		           remark						= #{remark}
		 WHERE enterprise_idx 		= #{enterpriseIdx}
		     AND member_id          	= #{memberId}    
	</select>	
	
<!-- 지적재산권현황 삭제 -->	
	<select id="deleteJcepBussAttract" parameterType="java.util.Map" resultType="int">
		DELETE FROM tb_jcep_buss_attract 
		WHERE enterprise_idx = #{enterpriseIdx}
			AND member_id not in 
				<foreach collection="memberId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>		
	</select>		
	
<!-- 사업찾기 - 지원사업수혜실적, 콘텐츠, 지적재산권현황 -->		
	<select id="selectBussSearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT
				A.buss_anncemnt_no AS bussAnncemntNo,
				A.buss_anncemnt_nm AS bussAnncemntNm,
				date_format(A.buss_fr_dt,'%Y-%m-%d') AS bussFrDt,
				date_format(A.buss_to_dt,'%Y-%m-%d')  AS bussToDt,
				A.buss_cost_amt AS bussCostAmt,
				A.buss_dept_cd AS bussDeptCd,
				(SELECT common_nm FROM ta_common t WHERE t.group_cd = 'G00023' AND common_cd = A.buss_dept_cd) AS bussDeptNm,
				A.original_url AS originalUrl,
				A.buss_cont AS bussCont,
				A.buss_divi_cd AS bussDiviCd,
				A.anncemnt_st_cd AS anncemntStCd,
				A.reg_dt AS regDt,
				A.reg_id AS regId
			FROM tb_business_announcement A
			WHERE 1=1
			  	AND A.buss_divi_cd = 'Y'
			<if test="searchType != null and searchType != ''">
		        AND A.buss_dept_cd = #{searchType}
			</if> 
			<if test="searchText != null and searchText != ''">
		        AND A.buss_anncemnt_nm LIKE CONCAT('%',#{searchText},'%')
			</if> 
			ORDER BY A.buss_anncemnt_no DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>	
	
<!-- 사업찾기 - 지원사업수혜실적, 콘텐츠 -->		
	<select id="selectBussSearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT
				count(*) totcnt
			FROM tb_business_announcement A
			WHERE 1=1
			  	AND A.buss_divi_cd = 'Y'
			<if test="searchType != null and searchType != ''">
		        AND A.buss_dept_cd = #{searchType}
			</if> 
			<if test="searchText != null and searchText != ''">
		        AND A.buss_anncemnt_nm LIKE CONCAT('%',#{searchText},'%')
			</if> 
	</select>			
			
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 -->			
<!--  장비,시설 활용실적 -->		
	<select id="selectBusinessInfraResourFaciUseResultList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT
				   a.enterprise_idx 	AS enterpriseIdx, 
				   a.perform_nm		AS resourcePerformNm, 
				   a.appli_no 			AS appliNo,
				   a.resour_faci_id 	AS resourFaciId,
			       b.resour_faci_nm 	AS resourFaciNm,
			       date_format(a.reg_dt,'%Y-%m-%d') AS regDt
			 FROM 
                 (SELECT t.enterprise_idx, 
                        MAX(t.perform_nm) AS perform_nm,
                        MAX(t.appli_no) AS appli_no,
                        MAX(t.resour_faci_id) AS resour_faci_id,
                        MIN(t.reg_dt) AS reg_dt
                    FROM tb_resource_use_result  t
                  GROUP BY t.enterprise_idx  
                 ) a 
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%') OR a.perform_nm LIKE CONCAT('%',#{searchText},'%'))
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%')
					</when>

				</choose>
			</if>			 
			<if test="searchFromDate != null and searchFromDate != ''">
                AND a.reg_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
                AND a.reg_dt <![CDATA[<= ]]>replace(#{searchToDate},'-','')
			</if> 					
			ORDER BY a.enterprise_idx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBusinessInfraResourFaciUseResultListTotCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT count(*) totcnt
			 FROM 
                 (SELECT t.enterprise_idx, 
                        MAX(t.perform_nm) AS perform_nm,
                        MAX(t.appli_no) AS appli_no,
                        MAX(t.resour_faci_id) AS resour_faci_id,
                        MIN(t.reg_dt) AS reg_dt
                    FROM tb_resource_use_result  t
                  GROUP BY t.enterprise_idx  
                 ) a 
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%') OR a.perform_nm LIKE CONCAT('%',#{searchText},'%'))
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%')
					</when>

				</choose>
			</if>			 
			<if test="searchFromDate != null and searchFromDate != ''">
                AND a.reg_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
                AND a.reg_dt <![CDATA[<= ]]>replace(#{searchToDate},'-','')
			</if>	
	</select>
	
	
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 장비시설 상세 -->
	<select id="selectBusinessInfraResourFaciUseResultDetailList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT
				   a.enterprise_idx AS enterpriseIdx, 
				   a.perform_nm	 AS resourcePerformNm, 
				   a.appli_no AS appliNo,
				   a.resour_faci_id AS resourFaciId,
			       a.member_id AS memberId,
			       a.use_dt AS useDt,
			       a.income_amt AS incomeAmt,
			       a.entpr_buss_pro_stus_nm AS entprBussProStusNm,
			       b.comp_nm AS compNm
			 FROM tb_resource_use_result  a
			 INNER JOIN tb_resour_faci_applicate b
			  ON a.appli_no = b.appli_no
			  AND a.member_id = b.member_id
			  AND a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1 
			 AND a.enterprise_idx = #{enterpriseIdx}
	</select>	
	
	
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 장비시설 찾기 리스트  -->		
	<select id="selectBussInfraResourFaciSearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT a.appli_no AS appliNo,
				   a.resour_faci_id AS resourFaciId,
			       a.member_id AS memberId,
			       a.comp_nm AS compNm,
			       b.resour_faci_nm AS resourFaciNm,
			       date_format(a.use_fr_dt,'%Y-%m-%d') AS useFrDt,
			       date_format(a.use_to_dt,'%Y-%m-%d') AS useToDt
			 FROM tb_resour_faci_applicate  a
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm,
			           '' AS facility_func_cd
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm,
			           t1.facility_func_cd AS facility_func_cd
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			 AND a.applic_st_cd = '000004'
			<if test="searchType != null and searchType != ''">
		        AND a.resour_faci_id = #{searchType}
			</if> 	
			<if test="searchType1 != null and searchType1 != ''">
		        AND b.facility_func_cd = #{searchType1}
			</if> 	
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
                               AND ((a.use_to_dt >= replace(#{searchFromDate},'-','') AND a.use_to_dt <= replace(#{searchToDate},'-',''))
                            OR (a.use_fr_dt >= replace(#{searchFromDate},'-','') AND a.use_fr_dt <= replace(#{searchToDate},'-',''))
                            OR (a.use_fr_dt <= replace(#{searchFromDate},'-','') AND a.use_to_dt >= replace(#{searchToDate},'-','')))
					]]>	     
			</if> 				
			ORDER BY a.resour_faci_id DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}						
	</select>			
	
	<select id="selectBussInfraResourFaciSearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT count(*) totcnt
			 FROM tb_resour_faci_applicate  a
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm,
			           '' AS facility_func_cd
			           
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm,
			           t1.facility_func_cd AS facility_func_cd
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			 AND a.applic_st_cd = '000004'	
			<if test="searchType != null and searchType != ''">
		        AND a.resour_faci_id = #{searchType}
			</if> 	
			<if test="searchType1 != null and searchType1 != ''">
		        AND b.facility_func_cd = #{searchType1}
			</if> 					
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           			AND ((a.use_to_dt >= replace(#{searchFromDate},'-','') AND a.use_to_dt <= replace(#{searchToDate},'-',''))
						    OR (a.use_fr_dt >= replace(#{searchFromDate},'-','') AND a.use_fr_dt <= replace(#{searchToDate},'-',''))
						    OR (a.use_fr_dt <= replace(#{searchFromDate},'-','') AND a.use_to_dt >= replace(#{searchToDate},'-','')))
					]]>	     
			</if> 						 
	</select>			
	
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 장비시설 선택 -->		
	<select id="selectBussInfraResourFaciSelectList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT a.appli_no AS appliNo,
				   a.resour_faci_id AS resourFaciId,
			       a.member_id AS memberId,
			       a.comp_nm AS compNm,
			       b.resour_faci_nm AS resourFaciNm,
			       date_format(a.use_fr_dt,'%Y-%m-%d') AS useFrDt,
			       date_format(a.use_to_dt,'%Y-%m-%d') AS useToDt
			 FROM tb_resour_faci_applicate  a
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			 AND a.applic_st_cd = '000004'
			<if test="membersId != null">
			    AND concat(a.resour_faci_id,a.member_id,a.appli_no) in 
				<foreach collection="membersId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
	</select>			
	
	
<!-- 장비시설 존재여부 조회 -->	
	<select id="selectBussInfraResourFaciCnt" parameterType="java.util.Map" resultType="int">
		SELECT count(*) cnt
		  FROM tb_resource_use_result 
		WHERE 1=1
			AND enterprise_idx       = #{enterpriseIdx}
		    AND resour_faci_id 		= #{resourFaciId}
		    AND member_id            = #{memberId}
		    AND appli_no            	= #{appliNo}
	</select>		
	
 <!-- idx 채번 -->	
	<select id="selectResourceEnterpriseIdx" parameterType="jcep.admin.model.BusinessVO" resultType="java.lang.String">
		SELECT concat('R',IFNULL(LPAD(MAX(SUBSTRING(enterprise_idx,2,LENGTH(enterprise_idx))) + 1,9,'0'),'000000000')) AS enterpriseIdx 
		  FROM tb_resource_use_result
	</select>		
	
<!-- 장비시설 등록 -->	
	<insert id="insertBussInfraResourFaci" parameterType="java.util.Map">
		INSERT INTO  tb_resource_use_result(
			enterprise_idx,
			resour_faci_id,
			member_id,
			appli_no,
			perform_nm,
			use_dt,
			income_amt,
			entpr_buss_pro_stus_nm,
			reg_dt,
			reg_id
		)VALUES(
	       #{enterpriseIdx},
	       #{resourFaciId},
			#{memberId},
			#{appliNo},
			#{resourcePerformNm},
			#{useDt},
			#{incomeAmt},
			#{entprBussProStusNm},
            date_format(CURRENT_TIMESTAMP,'%Y%m%d'),
			'admin'
		)

	</insert>	
	
<!-- 장비시설 수정 -->	
	<select id="updateBussInfraResourFaci" parameterType="java.util.Map" resultType="int">
		UPDATE tb_resource_use_result
		     SET perform_nm 						= #{resourcePerformNm},
		           use_dt              				= #{useDt},
		           income_amt						= #{incomeAmt},
		           entpr_buss_pro_stus_nm	= #{entprBussProStusNm}
		 WHERE enterprise_idx					= #{enterpriseIdx}
		 	 AND resour_faci_id 					= #{resourFaciId}
		     AND member_id          				= #{memberId}    
		     AND appli_no          				= #{appliNo}    
	</select>	
	
<!-- 장비시설 삭제 -->	
	<select id="deleteBussInfraResourFaci" parameterType="java.util.Map" resultType="int">
		DELETE FROM tb_resource_use_result 
		WHERE enterprise_idx = #{enterpriseIdx}
			AND concat(resour_faci_id,member_id,appli_no) not in 
				<foreach collection="memberId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>		
	</select>		
	

<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 기업입주현황 -->		
	<select id="selectBusinessInfraEnterpriseList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT
				   a.enterprise_idx AS enterpriseIdx, 
                   a.resour_faci_id AS resour_faci_id,
			       a.perform_nm AS entprPerformNm,
			       b.resour_faci_nm AS resourFaciNm,
			       date_format(a.reg_dt,'%Y-%m-%d') AS regDt
			 FROM 
                (SELECT t.enterprise_idx,
                        MAX(t.resour_faci_id) AS resour_faci_id,
					    MAX(t.perform_nm) AS perform_nm,
                        MIN(t.reg_dt) AS reg_dt
				   FROM tb_movein_result  t
                 GROUP BY t.enterprise_idx  
                )a   
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%') OR a.perform_nm LIKE CONCAT('%',#{searchText},'%'))
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%')
					</when>

				</choose>
			</if>			 
			<if test="searchFromDate != null and searchFromDate != ''">
                AND a.reg_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
                AND a.reg_dt <![CDATA[<= ]]>replace(#{searchToDate},'-','')
			</if>						
			ORDER BY a.enterprise_idx DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectBusinessInfraEnterpriseListTotCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT
				   count(*) totcnt
			 FROM 
                (SELECT t.enterprise_idx,
                        MAX(t.resour_faci_id) AS resour_faci_id,
					    MAX(t.perform_nm) AS perform_nm,
                        MIN(t.reg_dt) AS reg_dt
				   FROM tb_movein_result  t
                 GROUP BY t.enterprise_idx  
                )a   
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			<if test="searchText != null and searchText != ''">
		        <choose>
		        	<when test='searchType eq ""'>
						AND	(b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%') OR a.perform_nm LIKE CONCAT('%',#{searchText},'%'))
					</when>
		            <when test='searchType eq 1'>
						AND	a.perform_nm LIKE CONCAT('%',#{searchText},'%')
					</when>
		            <when test='searchType eq 2'>
						AND	b.resour_faci_nm LIKE CONCAT('%',#{searchText},'%')
					</when>

				</choose>
			</if>			 
			<if test="searchFromDate != null and searchFromDate != ''">
                AND a.reg_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
                AND a.reg_dt <![CDATA[<= ]]>replace(#{searchToDate},'-','')
			</if>					

	</select>	
	
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 기업입주 상세 -->
	<select id="selectBusinessInfraEnterpriseDetailList" parameterType="java.util.Map" resultType="java.util.Map">
			SELECT
				   a.enterprise_idx AS enterpriseIdx, 
				   a.appli_no AS appliNo,
				   a.resour_faci_id AS resourFaciId,
			       a.member_id AS memberId,
			       a.perform_nm AS entprPerformNm,
			       a.main_buss_cont AS mainBussCont,
                   date_format(a.movein_dt,'%Y-%m-%d') AS moveInDt,
			       b.comp_nm AS compNm,
			       (SELECT entpr_ceo FROM tb_enterprise t WHERE t.member_id = a.member_id) AS entprCeo
			 FROM tb_movein_result  a
			 INNER JOIN tb_resour_faci_applicate b
			  ON a.appli_no = b.appli_no
			  AND a.member_id = b.member_id
			  AND a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1 
			 AND a.enterprise_idx = #{enterpriseIdx}
	</select>	
	
	
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 기업입주 찾기 리스트  -->		
	<select id="selectBussInfraEntprResourFaciSearchList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT a.appli_no AS appliNo,
				   a.resour_faci_id AS resourFaciId,
			       a.member_id AS memberId,
			       a.comp_nm AS compNm,
			       b.resour_faci_nm AS resourFaciNm,
			       date_format(a.use_fr_dt,'%Y-%m-%d') AS useFrDt,
			       date_format(a.use_to_dt,'%Y-%m-%d') AS useToDt
			 FROM tb_resour_faci_applicate  a
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm,
			           '' AS facility_func_cd
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm,
			           t1.facility_func_cd AS facility_func_cd
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			 AND a.applic_st_cd = '000004'
			<if test="searchType != null and searchType != ''">
		        AND a.resour_faci_id = #{searchType}
			</if> 	
			<if test="searchType1 != null and searchType1 != ''">
		        AND b.facility_func_cd = #{searchType1}
			</if> 		
			<if test="searchFromDate != null and searchFromDate != ''">
       			AND a.use_to_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
		       <![CDATA[
          			AND a.use_to_dt <= replace(#{searchToDate},'-','')
				]]>	     
			</if> 					
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           			AND ((a.use_to_dt >= replace(#{searchFromDate},'-','') AND a.use_to_dt <= replace(#{searchToDate},'-',''))
						    OR (a.use_fr_dt >= replace(#{searchFromDate},'-','') AND a.use_fr_dt <= replace(#{searchToDate},'-',''))
						    OR (a.use_fr_dt <= replace(#{searchFromDate},'-','') AND a.use_to_dt >= replace(#{searchToDate},'-','')))
					]]>	     
			</if> 				 
			ORDER BY a.resour_faci_id DESC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}						
	</select>			
	
	<select id="selectBussInfraEntprResourFaciSearchListCnt" parameterType="jcep.admin.model.BusinessVO" resultType="int">
			SELECT count(*) totcnt
			 FROM tb_resour_faci_applicate  a
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm,
			           '' AS facility_func_cd
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm,
			           t1.facility_func_cd AS facility_func_cd
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			 AND a.applic_st_cd = '000004'	
			<if test="searchType != null and searchType != ''">
		        AND a.resour_faci_id = #{searchType}
			</if> 	
			<if test="searchType1 != null and searchType1 != ''">
		        AND b.facility_func_cd = #{searchType1}
			</if> 		
			<if test="searchFromDate != null and searchFromDate != ''">
       			AND a.use_to_dt >= replace(#{searchFromDate},'-','')
			</if> 		
			<if test="searchToDate != null and searchToDate != ''">
		       <![CDATA[
          			AND a.use_to_dt <= replace(#{searchToDate},'-','')
				]]>	     
			</if> 					
			<if test="searchFromDate != null and searchFromDate != '' and searchToDate != null and searchToDate != ''">
			       <![CDATA[
		           			AND ((a.use_to_dt >= replace(#{searchFromDate},'-','') AND a.use_to_dt <= replace(#{searchToDate},'-',''))
						    OR (a.use_fr_dt >= replace(#{searchFromDate},'-','') AND a.use_fr_dt <= replace(#{searchToDate},'-',''))
						    OR (a.use_fr_dt <= replace(#{searchFromDate},'-','') AND a.use_to_dt >= replace(#{searchToDate},'-','')))
					]]>	     
			</if> 				 
	</select>			
	
<!-- 사업관리 > 사업운영 실적관리 > 인프라지원 > 장비시설 선택 -->		
	<select id="selectBussInfraEntprResourFaciSelectList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
			SELECT a.appli_no AS appliNo,
				   a.resour_faci_id AS resourFaciId,
			       a.member_id AS memberId,
			       a.comp_nm AS compNm,
			       b.resour_faci_nm AS resourFaciNm,
			       date_format(a.use_fr_dt,'%Y-%m-%d') AS useFrDt,
			       date_format(a.use_to_dt,'%Y-%m-%d') AS useToDt,
			       (SELECT entpr_ceo FROM tb_enterprise t WHERE t.member_id = a.member_id) AS entprCeo
			 FROM tb_resour_faci_applicate  a
			 INNER JOIN (
				SELECT t.resour_faci_id,
			           t.resource_nm AS resour_faci_nm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id,
			           t1.facility_nm AS resour_faci_nm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
			 ) b 
			 ON a.resour_faci_id = b.resour_faci_id
			 WHERE 1=1
			 AND a.applic_st_cd = '000004'
			<if test="membersId != null">
			    AND concat(a.resour_faci_id,a.member_id,a.appli_no) in 
				<foreach collection="membersId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
	</select>			
	
	
<!-- 장비시설 존재여부 조회 -->	
	<select id="selectBussInfraEnterpriseCnt" parameterType="java.util.Map" resultType="int">
		SELECT count(*) cnt
		  FROM tb_movein_result 
		WHERE 1=1
		    AND enterprise_idx 		= #{enterpriseIdx}
		    AND resour_faci_id 		= #{resourFaciId}
		    AND member_id            = #{memberId}
		    AND appli_no            	= #{appliNo}
	</select>		
	
 <!-- idx 채번 -->	
	<select id="selectMoveInEnterpriseIdx" parameterType="jcep.admin.model.BusinessVO" resultType="java.lang.String">
		SELECT concat('M',IFNULL(LPAD(MAX(SUBSTRING(enterprise_idx,2,LENGTH(enterprise_idx))) + 1,9,'0'),'000000000')) AS enterpriseIdx 
		  FROM tb_movein_result
	</select>		
	
<!-- 장비시설 등록 -->	
	<insert id="insertBussInfraEnterprise" parameterType="java.util.Map">
		INSERT INTO  tb_movein_result(
			enterprise_idx,
			resour_faci_id,
			member_id,
			appli_no,
			perform_nm,
			main_buss_cont,
			movein_dt,
			reg_dt,
			reg_id
		)VALUES(
	       #{enterpriseIdx},
	       #{resourFaciId},
			#{memberId},
			#{appliNo},
			#{entprPerformNm},
			#{mainBussCont},
            replace(#{moveInDt},'-',''),
            date_format(CURRENT_TIMESTAMP,'%Y%m%d'),
			'admin'
		)

	</insert>	
	
<!-- 장비시설 수정 -->	
	<select id="updateBussInfraEnterprise" parameterType="java.util.Map" resultType="int">
		UPDATE tb_movein_result
		     SET perform_nm 						= #{entprPerformNm},
		           main_buss_cont	 			= #{mainBussCont},
                   movein_dt                           = replace(#{moveInDt},'-','')
		 WHERE enterprise_idx					= #{enterpriseIdx}
		 	 AND resour_faci_id 					= #{resourFaciId}
		     AND member_id          				= #{memberId}    
		     AND appli_no          				= #{appliNo}    
	</select>	
	
<!-- 장비시설 삭제 -->	
	<select id="deleteBussInfraEnterprise" parameterType="java.util.Map" resultType="int">
		DELETE FROM tb_movein_result 
		WHERE enterprise_idx = #{enterpriseIdx}
			AND concat(resour_faci_id,member_id,appli_no) not in 
				<foreach collection="memberId" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>		
	</select>	
	
<!-- 장비명 조회조건 코드 -->		
	<select id="selectResourFaciCodeList" parameterType="jcep.admin.model.BusinessVO" resultType="java.util.Map">
				SELECT t.resour_faci_id AS commonCd,
			           t.resource_nm AS commonNm
			      FROM tb_resource t
			     WHERE t.resource_st_cd = '000001'   
			    UNION ALL
			    SELECT t1.resour_faci_id AS commonCd,
			           t1.facility_nm AS commonNm
			      FROM tb_facility t1
			    WHERE t1.facility_st_cd = '000001'  
	</select>				
				
</mapper>

